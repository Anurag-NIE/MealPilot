<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true">

  <springProperty scope="context" name="APP_NAME" source="spring.application.name" defaultValue="mealpilot-api"/>
  <springProperty scope="context" name="APP_ENV" source="spring.profiles.active" defaultValue="default"/>

  <!-- JSON to stdout for containers/CI. Includes MDC (traceId/spanId) when tracing is enabled. -->
  <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
    <encoder class="net.logstash.logback.encoder.LogstashEncoder">
      <customFields>{"service":"${APP_NAME}","env":"${APP_ENV}"}</customFields>
    </encoder>
  </appender>

  <root level="INFO">
    <appender-ref ref="STDOUT"/>
  </root>

  <!-- Keep audit logs on the same JSON stream, but make them easy to filter by logger name. -->
  <logger name="audit" level="INFO" additivity="false">
    <appender-ref ref="STDOUT"/>
  </logger>

</configuration>
